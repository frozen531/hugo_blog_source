---
title: "01_计算机系统漫游"
date: 2023-06-27T21:19:23+08:00
draft: true
tags: ["深入理解计算机系统"]
categories: ["读书笔记"]
---


本章以最简单的hello进行一次旋风式的系统漫游。

```c
#include <stdio.h>

int main()
{
    printf("hello world! \n");
    return 0;
}
```

## 1. 从源程序到可执行文件

各种不同的高级语言经过不同的编译器后转换为统一的汇编语言。不同处理器体系架构对应的汇编指令也是不同的。

源程序到可执行文件的过程：

![源文件编译过程.png](深入理解计算机系统/源文件编译过程.png)

注：
1. 文件分为文本文件和二进制文件。文本文件是我们可以阅读并读懂的文件。
2. 所有文件都是由字节序列构成。文本文件是由于字节序列（整数）对应了某些字符（根据某些标准：ASCII，GB2312等），我们可以读懂。
3. 字节本质也是0和1的组合，在程序运行过程中，内存中的01序列既可以是数据（整数、浮点数、字符串），也可以是代码，分辨不同对象的唯一方法是上下文。

## 2. 计算机系统运行hello

计算机系统是由硬件和系统软件构成，它们共同作用来运行应用程序。

![一个典型系统的硬件组成.png](深入理解计算机系统/一个典型系统的硬件组成.png)

冯.诺依曼体系结构中计算机5大部件：控制器、运算器、存储器、输入设备和输出设备。

- CPU：中央处理器，主要用来执行存储在主存中的指令。主要包含：
> 1. 运算器ALU(算数逻辑单元，进行信息处理)；
> 2. 控制器（控制各器件工作）；
> 3. 其他部件（寄存器组（信息存储）等）

PC指针始终指向下一条待执行指令。通过控制总线、地址总线和数据总线，读取指令、读写数据并执行指令。
- 主存储器：一组动态随机存储器（DRAM），物理内存。程序执行时会加载入内存。
- 总线：携带信息在各个组件间传递。

> 根据总线位置划分为：
> 1. 内部总线：CPU内部，用来实现CPU内各器件间信息传递
> 2. 外部总线：相对与内部总线，实现CPU与主板上各器件的信息传递。这些总线从逻辑上讲分为：
> - 地址总线（宽度决定了CPU的寻址能力）
> - 控制总线（宽度决定了CPU对其他器件的控制能力）
> - 数据总线（宽度决定了CPU与其他器件一次性传送的数据量）。
- I/O设备：输入设备与输出设备。I/O设备通过控制器或适配器与I/O总线相连。主要区别在于它们的封装方式。每个PC都有一块主板，主板上包含有CPU、存储器、外围芯片组、扩展卡槽等。控制器是位于主板上的芯片组，而适配器是一块插在主板卡槽上的卡，称为接口卡。CPU通过总线想接口卡发送命令，接口卡根据CPU发送的命令控制外设工作。

DMA(直接存储器存取)技术，可以不经过CPU直接将数据从磁盘到达主存，用于数据搬运。相比于此，其他键盘输入、屏幕输出、指令执行等所有的操作都要在CPU走一遭。

## 3. 存储设备的层次结构

![存储器层次结构示意图.png](深入理解计算机系统/存储器层次结构示意图.png)

由于CPU处理的信息都来自于主存，系统需要花费大量时间白信息从一个地方挪到（复制）另一个地方。再加上CPU的处理速度远高于主存，系统为极可能快的完成这些操作，通过在处理器与主存间加入高速缓存（静态随机访问存储器SRAM），提高速度。

**局部性原理**：程序具有访问局部区域里的数据和代码的趋势。

高速缓存利用局部性原理，存放经常访问的代码和数据，使得大部分内存操作都能在高速缓存中完成。

- L1高速缓存容量可达数万字节，其访问速度同寄存器一样快
- L2高速缓存容量达数十万到数百万，比L1访问时间长5倍
- 存储器层次结构思想：下一层是上一层存储器的高速缓存

## 4. 操作系统管理硬件

![操作系统提供的抽象表示.png](深入理解计算机系统/操作系统提供的抽象表示.png)

操作系统向下管理硬件，向上向应用程序提供接口。

- 文件。Linux上一切皆文件。对于I/O设备，以文件的形式向应用程序提供统一的视图，通过统一的系统函数调用实现读写操作，程序员无需关心底层如何操作各种I/O设备。
- 进程。进程是操作系统对一个正在运行的程序的抽象。并发运行，每个进程好像独占使用硬件，实际上是通过CPU在进程间切换实现，这种交错执行的机制称为**上下文切换**。这种转换是由操作系统内核管理的。
- 线程。一个进程通常包含多个线程。线程相比进程更容易共享数据（同样的代码和全局数据），每个线程都运行在进程的上下文中，比进程更高效。
- 虚拟内存。为进程提供一个独占内存的假象。每个进程看到的地址都是一致的，称之为虚拟地址空间。在每个进程最高地址都有一段内核虚拟内存，内核是操作系统常驻主存的部分，用来执行应用程序中的系统调用，是系统管理全部进程所用代码和数据结构的集合，其并非是一个独立的进程。

## 5. 并发与并行

并发：指一个同时具有多个活动的系统。\
并行：用并发是一个系统运行的更快。

要想让系统运行的更快、更多，按照系统层次结构由高到低顺序强调三个层次。

- 线程级并发
对于单核处理器，通过快速切换任务“模拟”并发。\
**超线程技术**，使得一个处理器可同时运行多个控制流，在某些硬件（如：程序计数器、寄存器等）有多个备份，相比上面常规处理器，在极短时间内完成线程间切换。\
**多处理器系统**，指单操作系统内核控制的多处理器组成的系统，即多个CPU被集成到一个集成电路芯片上，由单个操作系统控制。
- 指令集并行，处理器同时执行多条指令。
- 单指令、多数据并行（SIMD），允许一条指令产生多个可并行执行的操作。主要用来提高处理视频、音频等数据的执行速度。


