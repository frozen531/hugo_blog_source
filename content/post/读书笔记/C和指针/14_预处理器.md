---
title: "14_é¢„å¤„ç†å™¨"
date: 2023-03-05T21:22:13+08:00
draft: true
tags: ["Cå’ŒæŒ‡é’ˆ"]
categories: ["è¯»ä¹¦ç¬”è®°"]
---

# é¢„å¤„ç†å™¨

## 1. é¢„å¤„ç†ä»‹ç»

- é¢„å¤„ç†æ˜¯æºä»£ç ç¼–è¯‘ä¹‹å‰è¿›è¡Œçš„æ–‡æœ¬æ€§è´¨çš„æ“ä½œ
- ä¸»è¦åŒ…æ‹¬ï¼š
> åˆ é™¤æ³¨é‡Š<br>
> æ’å…¥```#include```åŒ…å«çš„æ–‡ä»¶å†…å®¹<br>
> å®šä¹‰å’Œæ›¿æ¢```#define```æŒ‡ä»¤å®šä¹‰çš„ç¬¦å·<br>
> æ ¹æ®æ¡ä»¶ç¼–è¯‘æŒ‡ä»¤è¿›è¡Œç¼–è¯‘

## 2. é¢„å®šä¹‰ç¬¦å·

- ç”±é¢„å¤„ç†å™¨å®šä¹‰çš„ç¬¦å·

ç¬¦å· | æ ·ä¾‹ | å«ä¹‰
--- | --- | ---
```__FILE__``` | ```"name.c"``` | è¿›è¡Œç¼–è¯‘çš„æºæ–‡ä»¶å
```__LINE__``` | ```25``` | æ–‡ä»¶å½“å‰è¡Œçš„è¡Œå·
```__DATE__``` | ```"Jan 31 1997"``` | æ–‡ä»¶è¢«ç¼–è¯‘çš„æ—¥æœŸ
```__TIME__``` | ```"18:04:30"``` | æ–‡ä»¶è¢«ç¼–è¯‘çš„æ—¶é—´

## 3. é¢„å¤„ç†æŒ‡ä»¤

### ğŸ‰3.1 #define

- å‘½åçº¦å®šå…¨éƒ¨ä½¿ç”¨å¤§å†™å­—æ¯
- ```#define```è¯­å¥ä¸åŠ ```;```ï¼Œæ˜¯å› ä¸ºåœ¨è¿›è¡Œæ–‡æœ¬æ›¿æ¢æ—¶ï¼Œä»£ç ä¸­ä¼šåŠ ```;```
- å°†ä»»ä½•æ–‡æœ¬æ›¿æ¢åˆ°ç¨‹åºä¸­ï¼ŒåŒ…æ‹¬ï¼š
> 1. æ•°å€¼å­—é¢å€¼å¸¸é‡ ```#define MAX 15```
> 2. ä»¥å®šä¹‰çš„ç±»å‹å ```#define REG register```
> 3. è¯­å¥ ```#define CASE break;case```

```c
// ä¸‹é¢çš„å®šä¹‰æ˜¯ç”¨æ¥è°ƒè¯•æ‰“å°
#define DEBUG_PRINT printf("File %s line %d:" \
                        "x = %d, y = %d, z = %d", \
                        __FILE__, __LINE__, \
                        z, y, z)

x *= 2;
y += x;
z = x * y;
DEBUG_PRINT;
```

> 4. å®å®šä¹‰ï¼ŒåŠ å…¥å‚æ•°```#define name(para-list) stuff```

#### 3.1.1 å®

- <font color = #B766AD>**å¯¹æ•°å€¼è¡¨è¾¾å¼æ±‚å€¼çš„å®å®šä¹‰éƒ½åº”è¯¥åŠ ä¸Šæ‹¬å·**</font>ï¼Œé¿å…åœ¨ä½¿ç”¨å®æ—¶ï¼Œç”±äºæ“ä½œç¬¦çš„ä¼˜å…ˆçº§å¯¼è‡´ä¸å¯é¢„æ–™çš„ç›¸äº’ä½œç”¨

```c
/*
** æ¯ä¸ªå‚æ•°åŠ ():(x) * (x)
*/
#define SQUARE(x) x * x
a = 5;
printf("%d\n", SQUARE(a + 1)); // a + 1 * a + 1 = 5 + 1 * 5 + 1 = 11

#define SQUARE(x) (x) * (x)
a = 5;
printf("%d\n", SQUARE(a + 1)); // (a + 1) * (a + 1) = 6 * 6 = 36

/*
** æ•´ä¸ªè¡¨è¾¾å¼åŠ ():((x) + (x))
*/
#define DOUBLE(x) (x) + (x)
a = 5;
printf("%d\n", 10 * DOUBLE(a); // 10 * a + a = 10 * 5 + 5 = 55

#define DOUBLE(x) ((x) + (x))
a = 5;
printf("%d\n", 10 * DOUBLE(a); // 10 * (a + a) = 10 * 10 = 100
```

#### 3.1.2 å®ä¸å‡½æ•°

- å®ä¹Ÿå¯ä»¥å®ç°å‡½æ•°çš„åŠŸèƒ½
- å®ä¸å‡½æ•°å¯¹æ¯”ï¼š
> - å®ç›¸æ¯”å‡½æ•°çš„ä¼˜ç‚¹ï¼š
> > 1. ç›¸æ¯”è°ƒç”¨å‡½æ•°ï¼Œå®ä¸ç”¨è¿›è¡Œå‡½æ•°è°ƒç”¨æ—¶çš„ç°åœºä¿å­˜ï¼Œåœ¨é€Ÿåº¦ä¸Šæ›´æœ‰ä¼˜åŠ¿
> > 2. å‡½æ•°çš„å‚æ•°éœ€è¦æŒ‡æ˜ç±»å‹ï¼Œä½†æ˜¯å®å¹¶ä¸éœ€è¦å£°æ˜ç±»å‹ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨å„ç§ç±»å‹
> > 3. å¯ä»¥å®ç°å‡½æ•°å®ç°ä¸äº†çš„ä»»åŠ¡ï¼Œå°†ç±»å‹ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œè€Œå‡½æ•°åˆ™ä¸è¡Œ

```c
#define MALLOC(n, type) ((type *)malloc((n) * sizeof(type)))

pi = MALLOC(25, int); 
// é¢„å¤„ç†å™¨åšå¦‚ä¸‹æ›¿æ¢ï¼š
pi = ((int *)malloc((25) * sizeof(int))); 
```

> - å®ç›¸æ¯”å‡½æ•°çš„ç¼ºç‚¹ï¼š
> > 1. éœ€è¦åœ¨æ’å…¥ç‚¹å¤„å°†ä»£ç æ‹·è´åˆ°æ­¤å¤„ï¼Œä¼šå¢åŠ ç¨‹åºé•¿åº¦
> > 2. å®çš„å‚æ•°åœ¨å®å®šä¹‰ä¸­å‡ºç°çš„æ¬¡æ•°è¶…è¿‡ä¸€æ¬¡ï¼Œå¦‚æœè¿™ä¸ªå‚æ•°å…·æœ‰å‰¯ä½œç”¨ï¼Œä¼šé€ æˆä¸å¯é¢„æ–™çš„ç»“æœ

```c
#define MAX(a, b) ((a) > (b) ? (a) : (b))

x = 5;
y = 8;
z = MAX(x++, y++);
printf("x = %d, y = %d, z = %d\n", z, y, z);
// é¢„å¤„ç†å™¨åšå¦‚ä¸‹æ›¿æ¢ï¼š
MAX(x++, y++) ((x++) > (y++) ? (x++) : (y++))

// ç»“æœ
x = 6, y = 10, z = 9
```

### ğŸ‰3.2 #undef

- ç”¨äºç§»é™¤ä¸€ä¸ªå·²æœ‰çš„å®å®šä¹‰

```c
#undef MALLOC
```

### ğŸ‰3.3 æ¡ä»¶ç¼–è¯‘

- ğŸ”¸ é€‰æ‹©æŸç»„è¯­å¥è¿›è¡Œç¿»è¯‘æˆ–è¢«å¿½ç•¥

```c
#if constant-expression
    statements
#endif
```

> - ```constant-expression```ä¸ºå¸¸é‡è¡¨è¾¾å¼
> - ```constant-expression```ä¸º0ï¼Œé¢„å¤„ç†å™¨åˆ é™¤```statements```
> - ```constant-expression```ä¸ºé0ï¼Œ```statements```è¢«æ­£å¸¸ç¼–è¯‘

- ğŸ”¸ åœ¨ç¼–è¯‘æ—¶é€‰æ‹©ä¸åŒçš„ä»£ç éƒ¨åˆ†

```c
#if constant-expression
    statements
#elif constant-expression
    statements
#else
    statements
#endif
```

- ğŸ”¸ æµ‹è¯•ä¸€ä¸ªç¬¦å·æ˜¯å¦è¢«å®šä¹‰

```c
// å¦‚æœå®šä¹‰
#if defined(symbol) // ç­‰ä»·
#ifdef symbol

// å¦‚æœæœªå®šä¹‰
#if !defined(symbol) // ç­‰ä»·
#ifndef symbol

// åŒ…å«å¤šä¸ªæ¡ä»¶
#if defined(ABC) && defined(BCD)
```

- ğŸ”¸ æ¡ä»¶åµŒå¥—

```c
#if defined(ABC)
    #if defined(BCD)
    ...
    #endif
#endif
```

### ğŸ‰3.4 #include

- ```#include <>```ï¼šåŒ…å«æ ‡å‡†åº“æ–‡ä»¶
- ```#include ""```ï¼šåŒ…å«è‡ªå®šä¹‰å¤´æ–‡ä»¶
- åŒ…å«çš„å¤´æ–‡ä»¶ï¼Œé¢„å¤„ç†å™¨ä¼šå°†å¤´æ–‡ä»¶å†…å®¹å¤åˆ¶åˆ°æ–‡ä»¶ä¸­
- ä¸€ä¸ªæ–‡ä»¶è¢«å¤šæ¬¡åŒ…å«ä¼šé€ æˆé‡å®šä¹‰ï¼Œæ‰€ä»¥è¦é¿å…

```c
#ifndef HEAD_H
#define HEAD_H

// å¤´æ–‡ä»¶å†…å®¹

#endif
```

### ğŸ‰3.5å…¶ä»–æŒ‡ä»¤

#### 3.5.1 #error

#### 3.5.2 #line

#### 3.5.3 #progma
