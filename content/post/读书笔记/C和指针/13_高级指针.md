---
title: "13_高级指针"
date: 2023-03-05T21:22:12+08:00
draft: true
tags: ["C和指针"]
categories: ["读书笔记"]
---

# 高级指针话题

## 1. 多重指针

```c
int i;
int *pi = &i;
int **ppi = &pi;
```

变量 | 类型 | 说明
--- | --- | ---
```i``` | ```int``` | 整型变量
```pi``` | ```int *``` |指向整型类型的指针
```ppi``` | ```int **``` | 指向整型的指针的指针

## 2. 高级声明

### 🕊️2.1 ```*```的归属

```c
int *c; // (1)
int *a, b; // (2)
```

- 1. 将表达式```*c```声明为整型
- 2. ```a```为指针，```b```为```int```型整数

### 🕊️2.2 函数指针、数组的乱入

#### 2.2.1 声明的合法性

🐾 不合法的声明

- 函数的返回值不能是一个函数，例如```foo()()```非法
- 函数的返回值不能是一个数组，例如```foo()[]```非法
- 数组里面不能有函数，例如```foo[]()```非法

🐾 合法的声明

- 函数的返回值允许是一个函数指针，例如```int(* fun())()```
- 函数的返回值允许是一个指向数组的指针，例如```int(* foo())[]```
- 数组里面允许有函数指针，例如```int(*foo[])()```
- 数组里面允许有其他数组，例如```int foo[][]```

#### 2.2.2 声明中的优先级规则

步骤 | 说明
--- | ---
A | 从名字开始读取，然后按照下面的顺序依次读取
B | 1. 声明中被括号括起来的那部分，该括号是聚组作用 <br> 2. 后缀操作符：<br> 📌括号```()```表示是一个函数<br> 📌方括号```[]```表示是一个数组 <br> 3. 前缀操作符：星号```*```表示：指向...的指针
C | 如果```const```和（或）```volatile```的后面紧跟类型说明符，如```int```，```long```等，那么它作用于类型说明符。其他情况下，作用于左边的符号

- 举例说明：```char * const *(*next)()```

步骤 | 说明
--- | ---
A | 从名字开始读取，```next```
B | 1. 聚组作用的括号，```(*next)```，表示next是一个指向...的指针 <br> 2. 后缀操作符：括号```()```表示是一个函数，说明```next```是指向函数的指针，即函数指针<br>3. 前缀操作符：星号```*```表示：该函数返回值是一个指向...的指针
C | ```const```后面没有紧跟类型说明符，因此作用于左边紧邻的指针星号，说明```B3```中的前缀操作符```*```指向```char * const```，解释为一个指向字符的**指针常量**


#### 2.2.3 函数指针

- 函数指针多用于回调函数和转换表

```c
int f(int); // 函数声明
int (*pf)(int) = &f; // 声明函数指针并初始化
```

- 在初始化表达式中，```&```是可选的。函数名就好比变量名，但函数名在使用时就是被编译器转换为函数指针，而此处的```&```只是显示的说明了编译器隐式执行的任务

```c
// 函数调用
int ans;

ans = f(25); // (1)
ans = pf(25);  // (2)
ans = (*pf)(25); // (3)

```

- 1. 正常的函数调用。编译器先将函数名转换成函数指针，该指针指向函数在内存中的位置。然后，```()```操作符调用该函数
- 2. 函数指针调用。省去了编译器的转换过程
- 3. 函数指针解引用调用。函数指针解引用的结果就相当于函数名```f```，然后编译器再次执行将函数名转换为函数指针，再调用函数

#### 2.2.4 复杂的形式

🔸 函数指针与函数原型的比较

语句 | 说明
--- | ---
```int *f();``` | 按照操作符的优先级，f首先进行函数调用，返回值为```int *```类型
``` int (*f)();``` | ```f```是一个指针类型，对指针类型进行函数调用，故```f```为函数指针，返回值类型为```int```

> - ```()```（函数调用操作符）优先级高于```*```
> - 聚组作用的```()```优先级最高

🔸 数组与指针的结合

语句 | 说明
--- | ---
```int f[];``` | 这里忽略数组长度，```f[]```是一个表达式，表示```f```是数组名，数组中的数据类型为```int```
``` int *f[];``` | ```f```是数组名，数组中的数据类型为```int *```

> - ```[]```（下标操作符）优先级高于```*```

🔸 函数与数组的结合

语句 | 说明
--- | ---
```int f()[];``` | 按照优先级，```f```是一个函数名，返回类型为```int []```，即数组，但是函数只能返回标量，不能返回数组，所以该语句非法

> - ```()```（函数调用操作符）优先级高于```[]```

🔸 函数、指针和数组的结合

语句 | 说明
--- | ---
```int (*f[])();``` | 按照优先级，```f```是一个数组，元素类型为指针，```()```为函数调用操作符，故数组元素为函数指针，函数的返回值为```int```

## 3. 字符串常量

```c
char res = "xyz" + 1;
```

- 字符串常量的返回值是指向字符串常量的指针，```指针 + 1```相当于在首地址的基础上后移一位，所以```res = 'y'```

